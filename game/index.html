<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>搞笑互打游戏 - 拳皇搞笑版</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- 开始界面 -->
        <div id="start-screen" class="screen">
            <h1 class="title">🤣 搞笑互打游戏 🤣</h1>
            <p class="subtitle">拳皇搞笑版</p>
            
            <!-- 音效上传 -->
            <div class="audio-upload-container">
                <h4>自定义击中音效</h4>
                <div class="audio-info" id="audio-info">
                    <span class="audio-placeholder">🔊</span>
                    <span class="audio-text">未上传音频</span>
                </div>
                <input type="file" id="audio-upload" accept="audio/*" class="upload-input" onchange="uploadHitAudio(event)">
                <button class="btn upload-btn" onclick="document.getElementById('audio-upload').click()">上传击中音效</button>
            </div>
            
            <button class="btn primary" onclick="showCharacterSelect()">开始游戏</button>
        </div>

        <!-- 角色选择界面 -->
        <div id="character-select-screen" class="screen hidden">
            <h2>选择你的角色</h2>
            <div class="players-container">
                <!-- 背景图片上传 -->
                <div class="background-upload-container">
                    <h4>自定义战斗背景</h4>
                    <div class="background-preview" id="background-preview">
                        <div class="background-placeholder">🖼️</div>
                    </div>
                    <input type="file" id="background-upload" accept="image/*" class="upload-input" onchange="uploadBackground(event)">
                    <button class="btn upload-btn" onclick="document.getElementById('background-upload').click()">上传背景图片</button>
                </div>

                <!-- 玩家1选择 -->
                <div class="player-select" id="player1-select">
                    <h3>玩家 1</h3>
                    <div class="avatar-container" id="player1-avatar">
                        <div class="avatar-placeholder">👤</div>
                    </div>
                    <input type="file" id="player1-upload" accept="image/*" class="upload-input" onchange="uploadAvatar(1, event)">
                    <button class="btn upload-btn" onclick="document.getElementById('player1-upload').click()">上传头像</button>
                    <div class="toggle-container">
                        <label class="toggle-label">
                            <input type="checkbox" id="player1-auto-crop" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">启用抠图</span>
                        </label>
                    </div>
                    <div class="toggle-container">
                        <label class="toggle-label">
                            <input type="checkbox" id="player1-use-ai">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">AI抠图(需联网)</span>
                        </label>
                    </div>
                    <div class="api-config-container">
                        <h4>动画系统</h4>
                        <input type="password" class="api-token-input" id="player1-hf-token" placeholder="阿里云 API Key（可选）">
                        <button class="btn small-btn" onclick="generateProceduralAnimation(1)">生成动画帧</button>
                        <small class="api-hint">留空用程序化动画，填 Key 用 AI 生成</small>
                    </div>
                    <input type="text" class="player-name-input" id="player1-name" placeholder="输入角色名称" value="玩家1">
                    <div class="skill-upload-container">
                        <h4>自定义技能图片</h4>
                        <div class="skill-preview" id="player1-skill-preview">
                            <div class="skill-placeholder">🎯</div>
                        </div>
                        <input type="file" id="player1-skill-upload" accept="image/*" class="upload-input" onchange="uploadSkillImage(1, event)">
                        <button class="btn upload-btn" onclick="document.getElementById('player1-skill-upload').click()">上传技能图片</button>
                    </div>
                    <div class="video-upload-container">
                        <h4>冲击波前摇视频</h4>
                        <div class="video-preview" id="player1-video-preview">
                            <div class="video-placeholder">🎬</div>
                        </div>
                        <input type="file" id="player1-video-upload" accept="video/*" class="upload-input" onchange="uploadShockwaveVideo(1, event)">
                        <button class="btn upload-btn" onclick="document.getElementById('player1-video-upload').click()">上传前摇视频</button>
                    </div>
                    <div class="character-grid" id="player1-characters"></div>
                </div>

                <div class="vs-divider">VS</div>

                <!-- 玩家2选择 -->
                <div class="player-select" id="player2-select">
                    <h3>玩家 2</h3>
                    <div class="avatar-container" id="player2-avatar">
                        <div class="avatar-placeholder">👤</div>
                    </div>
                    <input type="file" id="player2-upload" accept="image/*" class="upload-input" onchange="uploadAvatar(2, event)">
                    <button class="btn upload-btn" onclick="document.getElementById('player2-upload').click()">上传头像</button>
                    <div class="toggle-container">
                        <label class="toggle-label">
                            <input type="checkbox" id="player2-auto-crop" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">启用抠图</span>
                        </label>
                    </div>
                    <div class="toggle-container">
                        <label class="toggle-label">
                            <input type="checkbox" id="player2-use-ai">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">AI抠图(需联网)</span>
                        </label>
                    </div>
                    <div class="api-config-container">
                        <h4>动画系统</h4>
                        <input type="password" class="api-token-input" id="player2-hf-token" placeholder="阿里云 API Key（可选）">
                        <button class="btn small-btn" onclick="generateProceduralAnimation(2)">生成动画帧</button>
                        <small class="api-hint">留空用程序化动画，填 Key 用 AI 生成</small>
                    </div>
                    <input type="text" class="player-name-input" id="player2-name" placeholder="输入角色名称" value="玩家2">
                    <div class="skill-upload-container">
                        <h4>自定义技能图片</h4>
                        <div class="skill-preview" id="player2-skill-preview">
                            <div class="skill-placeholder">🎯</div>
                        </div>
                        <input type="file" id="player2-skill-upload" accept="image/*" class="upload-input" onchange="uploadSkillImage(2, event)">
                        <button class="btn upload-btn" onclick="document.getElementById('player2-skill-upload').click()">上传技能图片</button>
                    </div>
                    <div class="video-upload-container">
                        <h4>冲击波前摇视频</h4>
                        <div class="video-preview" id="player2-video-preview">
                            <div class="video-placeholder">🎬</div>
                        </div>
                        <input type="file" id="player2-video-upload" accept="video/*" class="upload-input" onchange="uploadShockwaveVideo(2, event)">
                        <button class="btn upload-btn" onclick="document.getElementById('player2-video-upload').click()">上传前摇视频</button>
                    </div>
                    <div class="character-grid" id="player2-characters"></div>
                </div>
            </div>
            <button class="btn primary start-fight-btn" onclick="startGame()">开始战斗！</button>
        </div>

        <!-- 游戏界面 -->
        <div id="game-screen" class="screen hidden">
            <div class="game-header">
                <div class="player-info left">
                    <div class="player-header">
                        <img id="game-player1-avatar" class="game-avatar" src="" alt="">
                        <span id="game-player1-name">玩家1</span>
                    </div>
                    <div class="health-bar-container">
                        <div class="health-bar" id="player1-health">
                            <div class="health-fill" id="player1-health-fill"></div>
                        </div>
                    </div>
                    <div class="skills-info">
                        <div class="skills-info-title">WASD + IOPUKL</div>
                        <div class="skills-info-items">
                            <span>I:轻攻</span><span>O:重攻</span><span>P:冲击波</span><span>U:波动</span><span>L:金身</span><span>K:升龙</span>
                        </div>
                        <div class="cooldowns-info-mini" id="player1-cooldowns-mini">
                            <span class="cooldown-mini ready" data-skill="I">I</span>
                            <span class="cooldown-mini ready" data-skill="O">O</span>
                            <span class="cooldown-mini ready" data-skill="P">P</span>
                            <span class="cooldown-mini ready" data-skill="U">U</span>
                            <span class="cooldown-mini ready" data-skill="L">L</span>
                            <span class="cooldown-mini ready" data-skill="K">K</span>
                        </div>
                    </div>
                </div>
                <div class="player-info right">
                    <div class="player-header">
                        <img id="game-player2-avatar" class="game-avatar" src="" alt="">
                        <span id="game-player2-name">玩家2</span>
                    </div>
                    <div class="health-bar-container">
                        <div class="health-bar" id="player2-health">
                            <div class="health-fill" id="player2-health-fill"></div>
                        </div>
                    </div>
                    <div class="skills-info">
                        <div class="skills-info-title">方向键 + 数字键</div>
                        <div class="skills-info-items">
                            <span>1:轻攻</span><span>4:冲击波</span><span>5:金身</span><span>6:特殊</span><span>3:波动</span><span>2:升龙</span>
                        </div>
                        <div class="cooldowns-info-mini" id="player2-cooldowns-mini">
                            <span class="cooldown-mini ready" data-skill="1">1</span>
                            <span class="cooldown-mini ready" data-skill="4">4</span>
                            <span class="cooldown-mini ready" data-skill="5">5</span>
                            <span class="cooldown-mini ready" data-skill="6">6</span>
                            <span class="cooldown-mini ready" data-skill="3">3</span>
                            <span class="cooldown-mini ready" data-skill="2">2</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="battle-arena" id="battle-arena">
                <!-- 冲击波视频前摇层 -->
                <video id="shockwave-video" class="shockwave-video hidden" playsinline></video>
                <!-- 技能特效和建筑物容器 -->
                <div id="skill-effects"></div>
                <!-- 攻击范围指示器 -->
                <div id="attack-range-indicator"></div>
                <div class="fighter" id="fighter1">
                    <img id="fighter1-img" class="fighter-img" src="" alt="">
                    <div class="health-effect" id="fighter1-effect"></div>
                    <div class="health-number" id="fighter1-health-number">100</div>
                    <div class="fighter-state" id="fighter1-state">站立</div>
                </div>
                <div class="fighter" id="fighter2">
                    <img id="fighter2-img" class="fighter-img" src="" alt="">
                    <div class="health-effect" id="fighter2-effect"></div>
                    <div class="health-number" id="fighter2-health-number">100</div>
                    <div class="fighter-state" id="fighter2-state">站立</div>
                </div>
            </div>

            <div class="game-controls">
            </div>

            <!-- 连击提示 -->
            <div class="combo-display" id="combo-display">
                <div class="combo-player1" id="combo-player1"></div>
                <div class="combo-player2" id="combo-player2"></div>
            </div>

            <button class="btn pause-btn" onclick="pauseGame()">暂停</button>
        </div>

        <!-- 游戏结束界面 -->
        <div id="game-over-screen" class="screen hidden">
            <h2 id="winner-text">游戏结束</h2>
            <div id="winner-avatar" class="winner-avatar"></div>
            <button class="btn primary" onclick="restartGame()">再来一局</button>
            <button class="btn" onclick="showCharacterSelect()">返回选人</button>
        </div>

        <!-- 暂停界面 -->
        <div id="pause-screen" class="screen hidden">
            <h2>游戏暂停</h2>
            <button class="btn primary" onclick="resumeGame()">继续游戏</button>
            <button class="btn" onclick="restartGame()">重新开始</button>
            <button class="btn" onclick="showCharacterSelect()">返回选人</button>
        </div>
    </div>

    <script src="game.js"></script>
</body>
</html>
