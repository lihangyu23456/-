# 关节动画系统使用说明

## 概述

游戏使用**关节动画系统**，将人物分割成6个部位分别做动画，实现近似3D的真实动作效果。

---

## 动画特点

### 优势
- ✅ 完全免费
- ✅ 即时生成，无需等待
- ✅ 不需要任何API
- ✅ **基于用户头像**，保证人物一致
- ✅ **关节动画**，真实自然的动作效果

---

## 关节动画原理

### 身体部位分割

人物被分割成6个部位，每个部位独立运动：

| 部位 | 比例 | 说明 |
|-------|------|------|
| **头部** | 0-25% | 轻微点头、转向 |
| **躯干** | 25%-60% | 前倾、后仰 |
| **左臂** | 25%-60%（左半）| 摆动、攻击前伸 |
| **右臂** | 25%-60%（右半）| 摆动、攻击前伸 |
| **左腿** | 60%-100%（左半）| 行走摆动 |
| **右腿** | 60%-100%（右半）| 行走摆动 |

### 动画效果

#### 待机动画
- 轻微呼吸（缩放 0.98-1.02）
- 轻微晃动（左右 2px）

#### 行走动画
- **双腿交替摆动**（前后各 ±0.3 弧度）
- **双臂自然摆动**（前后各 ±0.2 弧度）
- 身体上下轻微跳动（5px）

#### 跳跃动画
- 双腿向后弯曲（-0.4 弧度）
- 双臂向前抬起（-0.3 弧度）
- 身体拉长（竖向 1.05倍）

#### 攻击动画
- **右臂前伸**（最大 -0.8 弧度）
- 左臂后摆（0.3 弧度）
- 躯干前倾（0.2 弧度）
- 头部跟随前倾（0.1 弧度）
- 整体前冲（30px）
- 金色发光效果

#### 防御动画
- **双臂交叉**（左臂 0.8，右臂 -0.8 弧度）
- 躯干后倾（-0.1 弧度）
- 半透明效果（70%）
- 蓝色盾牌光环

---

## 使用方法

### 自动生成
1. 上传头像（自动抠图）
2. 游戏自动生成关节动画帧
3. 开始游戏，人物会真实地动起来

### 手动生成
1. 上传头像
2. 点击"生成动画帧"
3. 开始游戏

---

## 技术实现

### 关节分割

```javascript
// 身体部位定义
const BODY_PARTS = {
    HEAD: { startY: 0, height: 0.25 },
    TORSO: { startY: 0.25, height: 0.35 },
    LEFT_ARM: { startY: 0.25, height: 0.35, side: 'left' },
    RIGHT_ARM: { startY: 0.25, height: 0.35, side: 'right' },
    LEFT_LEG: { startY: 0.6, height: 0.4, side: 'left' },
    RIGHT_LEG: { startY: 0.6, height: 0.4, side: 'right' }
};
```

### 部位旋转

```javascript
// 绘制单个身体部位（带旋转）
function drawBodyPart(ctx, imageSrc, part, angle, size, offsetY) {
    const startY = Math.floor(part.startY * size);
    const partHeight = Math.floor(part.height * size);

    ctx.save();

    // 设置旋转中心（部位底部）
    const pivotY = startY + partHeight;
    ctx.translate(sourceX + sourceW / 2, pivotY + offsetY);
    ctx.rotate(angle);
    ctx.translate(-(sourceX + sourceW / 2), -pivotY - offsetY);

    // 绘制部位
    ctx.drawImage(img, sourceX, startY, sourceW, partHeight, ...);

    ctx.restore();
}
```

---

## 自定义动画

### 调整关节角度

修改对应动作函数中的角度参数：

```javascript
// 行走：调整腿部摆动幅度
const leftLegAngle = Math.sin(frameIndex * Math.PI / 3) * 0.3; // 改成 0.5 更夸张

// 攻击：调整手臂前伸程度
const rightArmAngle = -progress * 0.8; // 改成 1.0 更远
```

### 调整部位比例

如果人物比例不同，可以修改 `BODY_PARTS`：

```javascript
const BODY_PARTS = {
    HEAD: { startY: 0, height: 0.3 }, // 头更大
    TORSO: { startY: 0.3, height: 0.3 },
    // ...
};
```

---

## 限制说明

### 当前实现的简化假设

关节动画系统假设：
1. 人物是**站立姿势**，正面朝向
2. 左右对称分布（左半身、右半身）
3. 不支持复杂的交叉动作

### 可能的问题

- ❌ 如果人物姿势不是标准站立，部位分割可能不准确
- ❌ 复杂动作（如翻身、打滚）无法实现
- ❌ 部位拼接处可能有轻微瑕疵

### 未来改进

如果需要更精确的效果，可以考虑：
1. 使用 **MediaPipe Pose** 进行人脸/人体关键点检测
2. 基于检测的关键点进行精确分割
3. 实现更复杂的关节运动

---

## 常见问题

### Q1: 为什么动画看起来有些僵硬？
A: 关节动画基于固定分割比例，如果人物姿势不标准，效果会有差异。可以尝试调整 `BODY_PARTS` 参数。

### Q2: 能否支持3D模型动画？
A: 当前是基于2D图片的程序化动画。3D模型需要使用 WebGL/Three.js 等技术。

### Q3: 为什么不用 AI 生成动画帧？
A: AI 无法保证生成的人物和用户头像一致，且成本高。关节动画基于用户头像，完全免费且效果可控。

### Q4: 如何让动画更流畅？
A: 可以增加帧数（如从6帧改成8帧），或者减小角度变化幅度。

---

## 总结

**核心优势：**
- ✅ 基于用户头像，保证人物一致
- ✅ 关节动画，真实的动作效果
- ✅ 完全免费，无需 API
- ✅ 即时生成，无需等待

**适用场景：**
- 格斗游戏
- 角色演示
- 简单动画需求
